<!DOCTYPE html>
<html>
<head>
  <link rel="stylesheet" type="text/css" href="/css/prism.css">
  <title>Post Details</title>
</head>
<body>
<h1>Post Details</h1>

<input type=hidden id="postId" th:value="${post.postId}">
<input type=hidden id="postWriter" th:value="${post.writerID}">
<input type=hidden id="currentUser" th:value="${member.id}">
<button id="updateBtn" onclick="updatePost()">글 수정하기!</button>
<button id="deleteBtn" onclick="deletePost()">글 삭제하기!</button>
<button id="recmdBtn" onclick="recmdPost()">글 추천하기!</button>

<table>
  <tr>
    <th>Post ID</th>
    <td th:text="${post.postId}"></td>
  </tr>
  <tr>
    <th>Create Date</th>
    <td th:text="${post.createDate}"></td>
  </tr>
  <tr>
    <th>Update Date</th>
    <td th:text="${post.updateDate}"></td>
  </tr>
  <tr>
    <th>Title</th>
    <td th:text="${post.title}"></td>
  </tr>
  <tr>
    <th>Contents</th>
    <td th:text="${post.contents}" id="contents"></td>
  </tr>
  <tr th:if="${post.imagePath}">
    <th>Image</th>
    <td>
      <img th:src="@{${post.imagePath}}" width="200" height="200" alt="Image">
    </td>
  </tr>
</table>
<script type="text/javascript" src="/js/prism.js"></script>
</body>
</html>

<style>
  table {
    margin-top: 20px;
  }

  table th {
    text-align: right;
    padding-right: 10px;
  }
</style>

<script>
  function chkWriter() {
    let writer=document.getElementById('postWriter').value;
    let user=document.getElementById('currentUser').value;
    let deleteBtn = document.getElementById('deleteBtn');
    let updateBtn = document.getElementById('updateBtn');

    if(writer===user) {
      deleteBtn.style.display = 'block';
      updateBtn.style.display = 'block';
    }
    else {
      deleteBtn.style.display = 'none';
      updateBtn.style.display = 'none';
    }
  }

  function makeContents() {
    let contentsElement = document.getElementById("contents");
    let boldText = contentsElement.textContent.replace(/\*\*(.*?)\*\*/g, "<strong>$1</strong>");
    let trimText = boldText.replace(/\n/g, "<br>");
    //let codeText = trimText.replace(/\'\'\'(.*?)\'\'\'/g, "<pre><code class=\"language-css\">$1</code></pre>");
    let codeText = trimText.replace(/('''(.*?)''')/g, function(match, p1) {
      p1 = match.replace(/'''<br>/g, "");
      p1 = p1.replace(/'''/g, "");
      p1 = p1.replace(/<br\s*>/g, "\n");
      return "<pre><code class=\"language-css\">" + p1 + "</code></pre>";
    });

    console.log(codeText);
    contentsElement.innerHTML = codeText;
    Prism.highlightAll();
  }

  document.addEventListener("DOMContentLoaded", function() {
    makeContents();
    chkWriter();
  });

  function deletePost(){
    let id=document.getElementById('postId').value;
    let isDelete =confirm("정말 삭제하시겠습니까?");
    if(isDelete){
      window.location.href="/post/"+id+"/deletePost";
    }
  }

  function updatePost() {
    let id = document.getElementById('postId').value;
    let isUpdate = confirm("게시글을 수정하시겠습니까?");
    if (isUpdate) {
      window.location.href = "/post/" + id + "/updatePost";
    }
  }

  function recmdPost(){
    let id = document.getElementById('postId').value;
    let Url = '/post/'+id+'/recmdPost';
    let otherPram = {
      method: 'POST',
    };
    fetch(Url, otherPram)
            .then((response) => response.json())
            .then((data) => {
              console.log(data);
            })
            .catch((error) => console.log(error));
  }
</script>